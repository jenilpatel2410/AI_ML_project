<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Voice Cloning</title>
    <style>
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        text-align: center;
        background: #f4f4f9;
        margin: 0;
        padding: 40px 20px;
      }
      .container {
        max-width: 600px;
        margin: 20px auto;
        padding: 20px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      textarea,
      input {
        width: 100%;
        padding: 10px;
        margin-top: 10px;
        border-radius: 5px;
        border: 1px solid #ccc;
      }
      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 12px 20px;
        font-size: 16px;
        border-radius: 5px;
        cursor: pointer;
        margin-top: 10px;
        transition: 0.3s;
      }
      button:hover {
        background: #0056b3;
      }
      button:disabled {
        background: #ccc;
        cursor: not-allowed;
      }
      #loader {
        display: none;
        font-size: 18px;
        font-weight: bold;
        color: #007bff;
        margin-top: 10px;
      }
      .home {
        display: inline-block;
        margin-top: 20px;
        padding: 10px 20px;
        background-color: #6c757d;
        color: white;
        text-decoration: none;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        font-family: inherit;
      }
      
      .home:hover {
        background-color: #5a6268;
      }
      
      label {
        text-align: left;
        display: block;
        margin-top: 15px;
        font-weight: 600;
        color: #555;
      }
      audio {
        margin-top: 20px;
        width: 100%;
      }
      
      h3 {
        margin-top: 30px;
        color: #333;
      }
      
      .home {
        display: inline-block;
        margin-top: 20px;
        padding: 10px 20px;
        background-color: #6c757d;
        color: white;
        text-decoration: none;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        font-family: inherit;
      }
      
      .home:hover {
        background-color: #5a6268;
      }

      select {
        width: 100%;
        padding: 10px;
        font-size: 16px;
        border: 1px solid #ccc;
        border-radius: 5px;
        margin-top: 10px;
        margin-bottom: 10px;
        background-color: #fff;
        background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20width%3D%2224%22%20height%3D%2224%22%20viewBox%3D%220%200%2024%2024%22%20fill%3D%22none%22%20stroke%3D%22%23007bff%22%20stroke-width%3D%222%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%20class%3D%22feather%20feather-chevron-down%22%3E%3Cpolyline%20points%3D%226%209%2012%2015%2018%209%22%3E%3C/polyline%3E%3C/svg%3E');
        background-repeat: no-repeat;
        background-position: right 10px center;
        background-size: 16px;
      }
    </style>
  </head>
  <body>
    {% include 'logout_header.html' %}
    <div class="container">
      <h1>Clone Your Voice</h1>

      <label>Upload Reference Audio:</label>
      <input type="file" id="audio" accept="audio/*" required />

      <label>Text to Synthesize:</label>
      <textarea id="text" rows="5" placeholder="Enter text here..." required></textarea>

      <label for="language">Select Language:</label>
      <select id="language" required>
        <option value="en">English</option>
        <option value="es">Spanish</option>
        <option value="fr">French</option>
        <option value="de">German</option>
        <option value="it">Italian</option>
        <option value="pt">Portuguese</option>
        <option value="pl">Polish</option>
        <option value="tr">Turkish</option>
        <option value="ru">Russian</option>
        <option value="nl">Dutch</option>
        <option value="cs">Czech</option>
        <option value="ar">Arabic</option>
        <option value="zh-cn">Chinese (Simplified)</option>
        <option value="hu">Hungarian</option>
        <option value="ko">Korean</option>
        <option value="ja">Japanese</option>
        <option value="hi">Hindi</option>
      </select>

      <button id="convert-btn" onclick="cloneVoice()">Clone Voice</button>

      <div id="loader">ðŸ”„ Cloning voice...</div>
      <div id="result"></div>

      <a href="/" class="home">Back to Home</a>
    </div>
    <script>
        function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let cookie of cookies) {
            cookie = cookie.trim();
            if (cookie.startsWith(name + '=')) {
                cookieValue = decodeURIComponent(cookie.slice(name.length + 1));
                break;
            }
            }
        }
        return cookieValue;
        }

        function cloneVoice() {
            const audioFile = document.getElementById('audio').files[0];
            const text = document.getElementById('text').value.trim();
            const language = document.getElementById('language').value;
            const loader = document.getElementById('loader');
            const result = document.getElementById('result');
            let convertBtn = document.getElementById('convert-btn')

            result.innerHTML = '';
            if (!audioFile || !text || !language) {
                alert("Please upload an audio file, enter some text, and select a language.");
                return;
            }

            const formData = new FormData();
            formData.append('audio', audioFile);
            formData.append('text', text);
            formData.append('language', language);

            loader.style.display = 'block';
            convertBtn.disabled = true;

            fetch('/api/voice-clone/', {
                method: 'POST',
                headers: {
                'X-CSRFToken': getCookie('csrftoken')
                },
                body: formData
            })
            .then(res => {
            if (!res.ok) throw new Error("Something went wrong.");
            return res.json();
            })
            .then(data => {
            if (data.audio_url) {
                result.innerHTML = `
                <h3>Cloned Audio:</h3>
                <audio controls src="${data.audio_url}"></audio>
                `;
            } else {
                result.innerHTML = `<p style='color: red;'>${data.error || "Failed to generate voice."}</p>`;
            }
            })
            .catch(err => {
                result.innerHTML = `<p style='color: red;'>Error: ${err.message}</p>`;
            })
            .finally(() => {
            loader.style.display = 'none';
            convertBtn.disabled = false;
            });
        }

    </script>

  </body>
</html>
